<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text File Merger for LLM</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .drop-zone {
            border: 3px dashed #4a90e2;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background-color: #f8fbff;
            margin-bottom: 20px;
        }

        .drop-zone:hover {
            border-color: #357abd;
            background-color: #e8f2ff;
        }

        .drop-zone.dragging {
            border-color: #2ecc71;
            background-color: #e8f8f5;
        }

        .drop-zone-text {
            color: #4a90e2;
            font-size: 18px;
            margin-bottom: 10px;
        }

        .drop-zone-subtext {
            color: #666;
            font-size: 14px;
        }

        .file-input {
            display: none;
        }

        .controls {
            display: flex;
            align-items: flex-start;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .control-row {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        label {
            font-weight: 500;
            color: #333;
        }

        input[type="number"] {
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            width: 80px;
            transition: border-color 0.3s;
        }

        input[type="number"]:focus {
            outline: none;
            border-color: #4a90e2;
        }

        select {
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            transition: border-color 0.3s;
            background-color: white;
            cursor: pointer;
        }

        select:focus {
            outline: none;
            border-color: #4a90e2;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background-color: #4a90e2;
            color: white;
        }

        .btn-primary:hover {
            background-color: #357abd;
        }

        .btn-primary:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .btn-secondary {
            background-color: #e74c3c;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #c0392b;
        }

        .file-list {
            margin-bottom: 30px;
        }

        .file-list h3 {
            color: #333;
            margin-bottom: 15px;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background-color: #f8f9fa;
            border-radius: 5px;
            margin-bottom: 8px;
            transition: background-color 0.3s;
        }

        .file-item:hover {
            background-color: #e9ecef;
        }

        .file-info {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
            min-width: 0;
        }

        .file-icon {
            color: #4a90e2;
            flex-shrink: 0;
        }

        .file-name {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .file-size {
            color: #666;
            font-size: 14px;
            flex-shrink: 0;
        }

        .remove-btn {
            background-color: transparent;
            color: #e74c3c;
            padding: 5px 10px;
            font-size: 14px;
            border: 1px solid #e74c3c;
            flex-shrink: 0;
        }

        .remove-btn:hover {
            background-color: #e74c3c;
            color: white;
        }

        .output-section {
            margin-top: 30px;
            padding-top: 30px;
            border-top: 2px solid #eee;
        }

        .output-item {
            background-color: #f0f8ff;
            border: 1px solid #4a90e2;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .output-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .output-title {
            font-weight: 600;
            color: #333;
        }

        .output-info {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }

        .download-btn {
            background-color: #2ecc71;
            color: white;
            padding: 8px 16px;
            font-size: 14px;
        }

        .download-btn:hover {
            background-color: #27ae60;
        }

        .stats {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 600;
            color: #4a90e2;
        }

        .stat-label {
            color: #666;
            font-size: 14px;
            margin-top: 5px;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background-color: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
            display: none;
        }

        .progress-fill {
            height: 100%;
            background-color: #4a90e2;
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-text {
            text-align: center;
            margin-top: 10px;
            color: #666;
            font-size: 14px;
            display: none;
        }

        .format-info {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 14px;
            color: #856404;
        }

        .format-info h4 {
            margin-bottom: 10px;
            color: #856404;
        }

        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .control-row {
                justify-content: space-between;
            }

            .file-info {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <h1>üìÑ Text File Merger for LLM</h1>
    <p class="subtitle">Merge multiple text files into LLM-friendly format to work around file limits</p>

    <div class="format-info">
        <h4>‚ÑπÔ∏è LLM-Friendly Features:</h4>
        <ul style="margin-left: 20px;">
            <li>Clear XML-style tags for file boundaries</li>
            <li>Structured metadata for each file</li>
            <li>Consistent formatting for easy parsing</li>
            <li>Support for folder drag & drop</li>
        </ul>
    </div>

    <div class="drop-zone" id="dropZone">
        <div class="drop-zone-text">üìÅ Drop files or folders here, or click to browse</div>
        <div class="drop-zone-subtext">Supports .txt, .md, .json, .csv, .log, and other text-based files</div>
    </div>
    <input type="file" id="fileInput" class="file-input" multiple accept=".txt,.md,.json,.csv,.log,.xml,.html,.js,.py,.java,.c,.cpp,.cs,.php,.rb,.go,.rs,.swift,.kt,.ts,.jsx,.vue,.sql,.yaml,.yml,.ini,.cfg,.conf" webkitdirectory>

    <div class="controls">
        <div class="control-group">
            <div class="control-row">
                <label for="outputCount">Number of output files:</label>
                <input type="number" id="outputCount" min="1" value="1">
            </div>
            <div class="control-row">
                <label for="outputFormat">Output format:</label>
                <select id="outputFormat">
                    <option value="xml">XML-style tags (Recommended)</option>
                    <option value="markdown">Markdown headers</option>
                    <option value="json">JSON-like structure</option>
                </select>
            </div>
        </div>
        <button class="btn-primary" id="mergeBtn" disabled>üîÄ Merge Files</button>
        <button class="btn-secondary" id="clearBtn">üóëÔ∏è Clear All</button>
    </div>

    <div class="progress-bar" id="progressBar">
        <div class="progress-fill" id="progressFill"></div>
    </div>
    <div class="progress-text" id="progressText"></div>

    <div class="stats" id="statsSection" style="display: none;">
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-value" id="totalFiles">0</div>
                <div class="stat-label">Total Files</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="totalSize">0 KB</div>
                <div class="stat-label">Total Size</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="avgFileSize">0</div>
                <div class="stat-label">Avg Files per Output</div>
            </div>
        </div>
    </div>

    <div class="output-section" id="outputSection" style="display: none;">
        <h3>üì¶ Output Files (LLM-Friendly Format)</h3>
        <div id="outputList"></div>
    </div>

    <div class="file-list" id="fileListSection" style="display: none;">
        <h3>üìã Selected Files (<span id="fileCount">0</span>)</h3>
        <div id="fileList"></div>
    </div>


</div>

<script>
    class FileMerger {
        constructor() {
            this.files = [];
            this.initializeElements();
            this.bindEvents();
        }

        initializeElements() {
            this.dropZone = document.getElementById('dropZone');
            this.fileInput = document.getElementById('fileInput');
            this.fileList = document.getElementById('fileList');
            this.fileListSection = document.getElementById('fileListSection');
            this.outputSection = document.getElementById('outputSection');
            this.outputList = document.getElementById('outputList');
            this.mergeBtn = document.getElementById('mergeBtn');
            this.clearBtn = document.getElementById('clearBtn');
            this.outputCountInput = document.getElementById('outputCount');
            this.outputFormatSelect = document.getElementById('outputFormat');
            this.fileCountSpan = document.getElementById('fileCount');
            this.statsSection = document.getElementById('statsSection');
            this.progressBar = document.getElementById('progressBar');
            this.progressFill = document.getElementById('progressFill');
            this.progressText = document.getElementById('progressText');
        }

        bindEvents() {
            // Drop zone events
            this.dropZone.addEventListener('click', () => this.fileInput.click());
            this.dropZone.addEventListener('dragover', this.handleDragOver.bind(this));
            this.dropZone.addEventListener('dragleave', this.handleDragLeave.bind(this));
            this.dropZone.addEventListener('drop', this.handleDrop.bind(this));

            // File input event
            this.fileInput.addEventListener('change', this.handleFileSelect.bind(this));

            // Button events
            this.mergeBtn.addEventListener('click', this.mergeFiles.bind(this));
            this.clearBtn.addEventListener('click', this.clearAll.bind(this));

            // Format change event
            this.outputFormatSelect.addEventListener('change', () => {
                if (this.outputSection.style.display === 'block') {
                    this.mergeFiles();
                }
            });
        }

        handleDragOver(e) {
            e.preventDefault();
            this.dropZone.classList.add('dragging');
        }

        handleDragLeave(e) {
            e.preventDefault();
            this.dropZone.classList.remove('dragging');
        }

        async handleDrop(e) {
            e.preventDefault();
            this.dropZone.classList.remove('dragging');

            const items = Array.from(e.dataTransfer.items);
            const files = [];

            this.showProgress('Processing dropped items...');

            for (const item of items) {
                if (item.kind === 'file') {
                    const entry = item.webkitGetAsEntry();
                    if (entry) {
                        await this.processEntry(entry, files);
                    }
                }
            }

            this.hideProgress();
            this.addFiles(files);
        }

        async processEntry(entry, files, path = '') {
            if (entry.isFile) {
                const file = await new Promise((resolve) => entry.file(resolve));
                if (this.isTextFile(file)) {
                    // Add relative path to file object
                    file.relativePath = path + file.name;
                    files.push(file);
                }
            } else if (entry.isDirectory) {
                const reader = entry.createReader();
                const entries = await new Promise((resolve) => reader.readEntries(resolve));

                for (const childEntry of entries) {
                    await this.processEntry(childEntry, files, path + entry.name + '/');
                }
            }
        }

        showProgress(text) {
            this.progressBar.style.display = 'block';
            this.progressText.style.display = 'block';
            this.progressText.textContent = text;
        }

        hideProgress() {
            setTimeout(() => {
                this.progressBar.style.display = 'none';
                this.progressText.style.display = 'none';
            }, 500);
        }

        handleFileSelect(e) {
            const files = Array.from(e.target.files);
            this.addFiles(files);
        }

        isTextFile(file) {
            // Check if it's a text-based file
            return file.type.startsWith('text/') ||
                file.type.includes('json') ||
                file.type.includes('xml') ||
                file.type.includes('javascript') ||
                file.type.includes('html') ||
                file.type === '' || // Some text files don't have a type
                this.hasTextExtension(file.name);
        }

        addFiles(newFiles) {
            const textFiles = newFiles.filter(file => this.isTextFile(file));
            this.files = [...this.files, ...textFiles];
            this.updateUI();
        }

        hasTextExtension(filename) {
            const textExtensions = ['.txt', '.md', '.json', '.csv', '.log', '.xml', '.html',
                '.js', '.py', '.java', '.c', '.cpp', '.cs', '.php',
                '.rb', '.go', '.rs', '.swift', '.kt', '.ts', '.jsx',
                '.vue', '.sql', '.yaml', '.yml', '.ini', '.cfg', '.conf'];
            return textExtensions.some(ext => filename.toLowerCase().endsWith(ext));
        }

        updateUI() {
            // Update file count
            this.fileCountSpan.textContent = this.files.length;

            // Show/hide sections
            this.fileListSection.style.display = this.files.length > 0 ? 'block' : 'none';
            this.statsSection.style.display = this.files.length > 0 ? 'block' : 'none';

            // Enable/disable merge button
            this.mergeBtn.disabled = this.files.length === 0;

            // Update file list
            this.renderFileList();

            // Update stats
            this.updateStats();
        }

        renderFileList() {
            this.fileList.innerHTML = '';

            this.files.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';

                const displayName = file.relativePath || file.name;

                fileItem.innerHTML = `
                        <div class="file-info">
                            <span class="file-icon">üìÑ</span>
                            <span class="file-name" title="${displayName}">${displayName}</span>
                            <span class="file-size">(${this.formatFileSize(file.size)})</span>
                        </div>
                        <button class="remove-btn" onclick="fileMerger.removeFile(${index})">Remove</button>
                    `;

                this.fileList.appendChild(fileItem);
            });
        }

        updateStats() {
            const totalSize = this.files.reduce((sum, file) => sum + file.size, 0);
            const outputCount = parseInt(this.outputCountInput.value) || 1;
            const avgFiles = Math.ceil(this.files.length / outputCount);

            document.getElementById('totalFiles').textContent = this.files.length;
            document.getElementById('totalSize').textContent = this.formatFileSize(totalSize);
            document.getElementById('avgFileSize').textContent = avgFiles;
        }

        formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        removeFile(index) {
            this.files.splice(index, 1);
            this.updateUI();
        }

        clearAll() {
            this.files = [];
            this.outputSection.style.display = 'none';
            this.outputList.innerHTML = '';
            this.fileInput.value = '';
            this.updateUI();
        }

        async mergeFiles() {
            const outputCount = parseInt(this.outputCountInput.value) || 1;

            // Show progress bar
            this.showProgress('Reading files...');
            this.progressFill.style.width = '0%';

            // Read all files
            const fileContents = [];
            for (let i = 0; i < this.files.length; i++) {
                const file = this.files[i];
                const content = await this.readFile(file);
                fileContents.push({
                    name: file.relativePath || file.name,
                    originalName: file.name,
                    size: file.size,
                    content: content
                });

                // Update progress
                const progress = ((i + 1) / this.files.length) * 50; // First 50% for reading
                this.progressFill.style.width = progress + '%';
                this.progressText.textContent = `Reading file ${i + 1} of ${this.files.length}...`;
            }

            // Distribute files across output files
            this.progressText.textContent = 'Merging files...';
            const filesPerOutput = Math.ceil(fileContents.length / outputCount);
            const outputs = [];

            for (let i = 0; i < outputCount; i++) {
                const startIdx = i * filesPerOutput;
                const endIdx = Math.min(startIdx + filesPerOutput, fileContents.length);
                const outputFiles = fileContents.slice(startIdx, endIdx);

                if (outputFiles.length > 0) {
                    outputs.push(this.createMergedContent(outputFiles, i + 1));
                }

                // Update progress
                const progress = 50 + ((i + 1) / outputCount) * 50; // Last 50% for merging
                this.progressFill.style.width = progress + '%';
            }

            // Display outputs
            this.displayOutputs(outputs);
            this.hideProgress();
        }

        readFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => resolve(e.target.result);
                reader.onerror = reject;
                reader.readAsText(file);
            });
        }

        createMergedContent(files, outputNumber) {
            const format = this.outputFormatSelect.value;
            const timestamp = new Date().toISOString();
            let mergedContent = '';
            let name = ``;

            switch (format) {
                case 'xml':
                    mergedContent = this.createXMLFormat(files, outputNumber, timestamp);
                    name = `merged_output_${outputNumber}.xml`;
                    break;
                case 'markdown':
                    mergedContent = this.createMarkdownFormat(files, outputNumber, timestamp);
                    name = `merged_output_${outputNumber}.md`;
                    break;
                case 'json':
                    mergedContent = this.createJSONFormat(files, outputNumber, timestamp);
                    name = `merged_output_${outputNumber}.json`;
                    break;
            }

            return {
                name: name,
                content: mergedContent,
                fileCount: files.length,
                files: files.map(f => f.name),
                format: format
            };
        }

        createXMLFormat(files, outputNumber, timestamp) {
            let content = `<merged_document>
  <metadata>
    <output_number>${outputNumber}</output_number>
    <timestamp>${timestamp}</timestamp>
    <total_files>${files.length}</total_files>
    <format>LLM-friendly XML structure</format>
  </metadata>

  <files>\n`;

            files.forEach((file, index) => {
                content += `    <file index="${index + 1}">
      <filename>${this.escapeXML(file.name)}</filename>
      <size>${file.size} bytes</size>
      <content>
<![CDATA[
${file.content}
]]>
      </content>
    </file>\n\n`;
            });

            content += `  </files>
</merged_document>`;

            return content;
        }

        createMarkdownFormat(files, outputNumber, timestamp) {
            let content = `# Merged Document ${outputNumber}

## Metadata
- **Generated:** ${timestamp}
- **Total Files:** ${files.length}
- **Format:** LLM-friendly Markdown structure

---

## Files

`;

            files.forEach((file, index) => {
                content += `### File ${index + 1}: ${file.name}
**Size:** ${file.size} bytes

\`\`\`
${file.content}
\`\`\`

---

`;
            });

            return content;
        }

        createJSONFormat(files, outputNumber, timestamp) {
            const data = {
                metadata: {
                    output_number: outputNumber,
                    timestamp: timestamp,
                    total_files: files.length,
                    format: "LLM-friendly JSON structure"
                },
                files: files.map((file, index) => ({
                    index: index + 1,
                    filename: file.name,
                    size_bytes: file.size,
                    content: file.content
                }))
            };

            return JSON.stringify(data, null, 2);
        }

        escapeXML(text) {
            return text
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&apos;');
        }

        displayOutputs(outputs) {
            this.outputSection.style.display = 'block';
            this.outputList.innerHTML = '';

            outputs.forEach((output, index) => {
                const outputItem = document.createElement('div');
                outputItem.className = 'output-item';

                const blob = new Blob([output.content], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);

                const formatLabel = {
                    'xml': 'XML-style tags',
                    'markdown': 'Markdown',
                    'json': 'JSON'
                }[output.format];

                outputItem.innerHTML = `
                        <div class="output-header">
                            <span class="output-title">üìÑ ${output.name}</span>
                            <a href="${url}" download="${output.name}" class="download-btn">‚¨áÔ∏è Download</a>
                        </div>
                        <div class="output-info">
                            <strong>Format:</strong> ${formatLabel}<br>
                            <strong>Contains ${output.fileCount} files:</strong> ${output.files.join(', ')}
                        </div>
                    `;

                this.outputList.appendChild(outputItem);
            });
        }
    }

    // Initialize the app
    const fileMerger = new FileMerger();
</script>
</body>
</html>
